@using EquineElegance.Entities

@{
    ViewBag.Title = "Winkelkar";
}

<h2>Winkelkar</h2>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">
        @TempData["Success"]
    </div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">
        @TempData["Error"]
    </div>
}

<!-- Add a form to enter the discount code -->
<form action="@Url.Action("ApplyDiscountCode", "Cart")" method="post">
    <label for="discountCode">Kortingscode:</label>
    <input type="text" id="discountCode" name="discountCode" />
    <button type="submit">Voeg kortingscode toe</button>
</form>

@if (Session["cart"] != null)
{
    Cart cart = (Cart)Session["cart"];
    if (cart.CartItems != null && cart.CartItems.Any())
    {
        <table>
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Aantal</th>
                    <th>Prijs</th>
                    <th>Acties</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in cart.CartItems)
                {
                    <tr>
                        <td>@item.Product.Name</td>
                        <td>@item.Amount</td>
                        @{
                            decimal productPrice = item.Amount * item.Product.Price;
                        }
                        <td>€@productPrice</td>
                        <td>
                            @Html.ActionLink("+", "IncreaseQuantity", "Cart", new { productId = item.Product.ProductId, productType = item.ProductType }, null)
                            @Html.ActionLink("-", "DecreaseQuantity", "Cart", new { productId = item.Product.ProductId, productType = item.ProductType }, null)
                            @Html.ActionLink("Verwijderen", "RemoveProduct", "Cart", new { productId = item.Product.ProductId, productType = item.ProductType }, null)
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <!-- Show the discount and total price -->
        <p>
            Kortingscode: @ViewBag.DiscountCode <br />
            Korting: €@ViewBag.Discount <br />
            Totaalprijs: €@(cart.CartItems.Sum(item => item.Product.Price * item.Amount) - ViewBag.Discount)
        </p>
    }
    else
    {
        <p>Uw winkelkar is leeg.</p>
    }
}
else
{
    <p>Uw winkelkar is leeg.</p>
}

@Html.ActionLink("Kar leegmaken", "ClearCart", "Cart")
